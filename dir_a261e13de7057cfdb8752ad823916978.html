<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: C:/Users/arisc/OneDrive/Documents/GitHub/FINAL/EcoEats-Project/node_modules/workerpool Directory Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('dir_a261e13de7057cfdb8752ad823916978.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">workerpool Directory Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Directory dependency graph for workerpool:</div>
<div class="dyncontent">
<div class="center"><img src="dir_a261e13de7057cfdb8752ad823916978_dep.png" border="0" usemap="#adir__a261e13de7057cfdb8752ad823916978__dep" loading="lazy" alt="C:/Users/arisc/OneDrive/Documents/GitHub/FINAL/EcoEats-Project/node_modules/workerpool"/></div>
</div>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<h1 class="doxsection"><a class="anchor" id="autotoc_md15513"></a>
workerpool</h1>
<p><a href="https://www.npmjs.com/package/workerpool"><img src="https://img.shields.io/npm/v/workerpool" alt="NPM Version" class="inline"/></a> <a href="https://npm-compare.com/workerpool/#timeRange=FIVE_YEARS"><img src="https://img.shields.io/npm/dm/workerpool" alt="NPM Downloads" class="inline"/></a> <a href="https://github.com/josdejong/workerpool/blob/master/LICENSE"><img src="https://img.shields.io/npm/l/workerpool" alt="NPM License" class="inline"/></a></p>
<p><b>workerpool</b> offers an easy way to create a pool of workers for both dynamically offloading computations as well as managing a pool of dedicated workers. <b>workerpool</b> basically implements a <a href="http://en.wikipedia.org/wiki/Thread_pool_pattern">thread pool pattern</a>. There is a pool of workers to execute tasks. New tasks are put in a queue. A worker executes one task at a time, and once finished, picks a new task from the queue. Workers can be accessed via a natural, promise based proxy, as if they are available straight in the main application.</p>
<p><b>workerpool</b> runs on Node.js and in the browser.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md15514"></a>
Features</h1>
<ul>
<li>Easy to use</li>
<li>Runs in the browser and on node.js</li>
<li>Dynamically offload functions to a worker</li>
<li>Access workers via a proxy</li>
<li>Cancel running tasks</li>
<li>Set a timeout on tasks</li>
<li>Handles crashed workers</li>
<li>Small: 9 kB minified and gzipped</li>
<li>Supports transferable objects (only for web workers and worker_threads)</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md15515"></a>
Why</h1>
<p>JavaScript is based upon a single event loop which handles one event at a time. Jeremy Epstein <a href="http://greenash.net.au/thoughts/2012/11/nodejs-itself-is-blocking-only-its-io-is-non-blocking/">explains this clearly</a>:</p>
<blockquote class="doxtable">
<p>In Node.js everything runs in parallel, except your code. What this means is that all I/O code that you write in Node.js is non-blocking, while (conversely) all non-I/O code that you write in Node.js is blocking. </p>
</blockquote>
<p>This means that CPU heavy tasks will block other tasks from being executed. In case of a browser environment, the browser will not react to user events like a mouse click while executing a CPU intensive task (the browser "hangs"). In case of a node.js server, the server will not respond to any new request while executing a single, heavy request.</p>
<p>For front-end processes, this is not a desired situation. Therefore, CPU intensive tasks should be offloaded from the main event loop onto dedicated <em>workers</em>. In a browser environment, <a href="http://www.html5rocks.com/en/tutorials/workers/basics/">Web Workers</a> can be used. In node.js, <a href="https://nodejs.org/api/child_process.html">child processes</a> and <a href="https://nodejs.org/api/worker_threads.html">worker_threads</a> are available. An application should be split in separate, decoupled parts, which can run independent of each other in a parallelized way. Effectively, this results in an architecture which achieves concurrency by means of isolated processes and message passing.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md15516"></a>
Install</h1>
<p>Install via npm: </p><pre class="fragment">npm install workerpool
</pre><h1 class="doxsection"><a class="anchor" id="autotoc_md15517"></a>
Load</h1>
<p>To load workerpool in a node.js application (both main application as well as workers):</p>
<div class="fragment"><div class="line">const workerpool = require(&#39;workerpool&#39;);</div>
</div><!-- fragment --><p>To load workerpool in the browser:</p>
<div class="fragment"><div class="line">&lt;script src=&quot;workerpool.js&quot;&gt;&lt;/script&gt;</div>
</div><!-- fragment --><p>To load workerpool in a web worker in the browser:</p>
<div class="fragment"><div class="line">importScripts(&#39;workerpool.js&#39;);</div>
</div><!-- fragment --><p>Setting up the workerpool with React or webpack5 requires additional configuration steps, as outlined in the webpack5 section.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md15518"></a>
Use</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md15519"></a>
Offload functions dynamically</h2>
<p>In the following example there is a function <span class="tt">add</span>, which is offloaded dynamically to a worker to be executed for a given set of arguments.</p>
<p><b>myApp.js</b></p>
<div class="fragment"><div class="line">const workerpool = require(&#39;workerpool&#39;);</div>
<div class="line">const pool = workerpool.pool();</div>
<div class="line"> </div>
<div class="line">function add(a, b) {</div>
<div class="line">  return a + b;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">pool</div>
<div class="line">  .exec(add, [3, 4])</div>
<div class="line">  .then(function (result) {</div>
<div class="line">    console.log(&#39;result&#39;, result); // outputs 7</div>
<div class="line">  })</div>
<div class="line">  .catch(function (err) {</div>
<div class="line">    console.error(err);</div>
<div class="line">  })</div>
<div class="line">  .then(function () {</div>
<div class="line">    pool.terminate(); // terminate all workers when done</div>
<div class="line">  });</div>
</div><!-- fragment --><p>Note that both function and arguments must be static and stringifiable, as they need to be sent to the worker in a serialized form. In case of large functions or function arguments, the overhead of sending the data to the worker can be significant.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md15520"></a>
Dedicated workers</h2>
<p>A dedicated worker can be created in a separate script, and then used via a worker pool.</p>
<p><b>myWorker.js</b></p>
<div class="fragment"><div class="line">const workerpool = require(&#39;workerpool&#39;);</div>
<div class="line"> </div>
<div class="line">// a deliberately inefficient implementation of the fibonacci sequence</div>
<div class="line">function fibonacci(n) {</div>
<div class="line">  if (n &lt; 2) return n;</div>
<div class="line">  return fibonacci(n - 2) + fibonacci(n - 1);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// create a worker and register public functions</div>
<div class="line">workerpool.worker({</div>
<div class="line">  fibonacci: fibonacci,</div>
<div class="line">});</div>
</div><!-- fragment --><p>This worker can be used by a worker pool:</p>
<p><b>myApp.js</b></p>
<div class="fragment"><div class="line">const workerpool = require(&#39;workerpool&#39;);</div>
<div class="line"> </div>
<div class="line">// create a worker pool using an external worker script</div>
<div class="line">const pool = workerpool.pool(__dirname + &#39;/myWorker.js&#39;);</div>
<div class="line"> </div>
<div class="line">// run registered functions on the worker via exec</div>
<div class="line">pool</div>
<div class="line">  .exec(&#39;fibonacci&#39;, [10])</div>
<div class="line">  .then(function (result) {</div>
<div class="line">    console.log(&#39;Result: &#39; + result); // outputs 55</div>
<div class="line">  })</div>
<div class="line">  .catch(function (err) {</div>
<div class="line">    console.error(err);</div>
<div class="line">  })</div>
<div class="line">  .then(function () {</div>
<div class="line">    pool.terminate(); // terminate all workers when done</div>
<div class="line">  });</div>
<div class="line"> </div>
<div class="line">// or run registered functions on the worker via a proxy:</div>
<div class="line">pool</div>
<div class="line">  .proxy()</div>
<div class="line">  .then(function (worker) {</div>
<div class="line">    return worker.fibonacci(10);</div>
<div class="line">  })</div>
<div class="line">  .then(function (result) {</div>
<div class="line">    console.log(&#39;Result: &#39; + result); // outputs 55</div>
<div class="line">  })</div>
<div class="line">  .catch(function (err) {</div>
<div class="line">    console.error(err);</div>
<div class="line">  })</div>
<div class="line">  .then(function () {</div>
<div class="line">    pool.terminate(); // terminate all workers when done</div>
<div class="line">  });</div>
</div><!-- fragment --><p>Worker can also initialize asynchronously:</p>
<p><b>myAsyncWorker.js</b></p>
<div class="fragment"><div class="line">define([&#39;workerpool/dist/workerpool&#39;], function (workerpool) {</div>
<div class="line">  // a deliberately inefficient implementation of the fibonacci sequence</div>
<div class="line">  function fibonacci(n) {</div>
<div class="line">    if (n &lt; 2) return n;</div>
<div class="line">    return fibonacci(n - 2) + fibonacci(n - 1);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  // create a worker and register public functions</div>
<div class="line">  workerpool.worker({</div>
<div class="line">    fibonacci: fibonacci,</div>
<div class="line">  });</div>
<div class="line">});</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md15521"></a>
Examples</h1>
<p>Examples are available in the examples directory:</p>
<p><a href="https://github.com/josdejong/workerpool/tree/master/examples">https://github.com/josdejong/workerpool/tree/master/examples</a></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md15522"></a>
API</h1>
<p>The API of workerpool consists of two parts: a function <span class="tt">workerpool.pool</span> to create a worker pool, and a function <span class="tt">workerpool.worker</span> to create a worker.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md15523"></a>
pool</h2>
<p>A workerpool can be created using the function <span class="tt">workerpool.pool</span>:</p>
<p><span class="tt">workerpool.pool([script: string] [, options: Object]) : Pool</span></p>
<p>When a <span class="tt">script</span> argument is provided, the provided script will be started as a dedicated worker. When no <span class="tt">script</span> argument is provided, a default worker is started which can be used to offload functions dynamically via <span class="tt">Pool.exec</span>. Note that on node.js, <span class="tt">script</span> must be an absolute file path like &lsquo;__dirname + &rsquo;/myWorker.js'<span class="tt">. In a browser environment, </span>script<span class="tt"> can also be a data URL like </span>'data:application/javascript;base64,...'<span class="tt">. This allows embedding the bundled code of a worker in your main application. See </span>examples/embeddedWorker` for a demo.</p>
<p>The following options are available:</p>
<ul>
<li>&lsquo;minWorkers: number | 'max&rsquo;<span class="tt">. The minimum number of workers that must be initialized and kept available. Setting this to </span>'max'<span class="tt"> will create </span>maxWorkers<span class="tt"> default workers (see below).</span></li>
<li><span class="tt"></span>maxWorkers: number<span class="tt">. The default number of maxWorkers is the number of CPU's minus one. When the number of CPU's could not be determined (for example in older browsers), </span>maxWorkers<span class="tt"> is set to 3.</span></li>
<li><span class="tt"></span>maxQueueSize: number<span class="tt">. The maximum number of tasks allowed to be queued. Can be used to prevent running out of memory. If the maximum is exceeded, adding a new task will throw an error. The default value is </span>Infinity<span class="tt">.</span></li>
<li><span class="tt"></span>workerType: 'auto' | 'web' | 'process' | 'thread'<span class="tt">.<ul>
<li>In case of </li>
</ul>
</span>'auto'<span class="tt"> (default), workerpool will automatically pick a suitable type of worker: when in a browser environment, </span>'web'<span class="tt"> will be used. When in a node.js environment, </span>worker_threads<span class="tt"> will be used if available (Node.js &gt;= 11.7.0), else </span>child_process<span class="tt"> will be used.<ul>
<li>In case of </li>
</ul>
</span>'web'<span class="tt">, a Web Worker will be used. Only available in a browser environment.<ul>
<li>In case of </li>
</ul>
</span>'process'<span class="tt">, </span>child_process<span class="tt"> will be used. Only available in a node.js environment.<ul>
<li>In case of </li>
</ul>
</span>'thread'<span class="tt">, </span>worker_threads<span class="tt"> will be used. If </span>worker_threads<span class="tt"> are not available, an error is thrown. Only available in a node.js environment.</span></li>
<li><span class="tt"></span>workerTerminateTimeout: number<span class="tt">. The timeout in milliseconds to wait for a worker to cleanup it's resources on termination before stopping it forcefully. Default value is </span>1000<span class="tt">.</span></li>
<li><span class="tt"></span>abortListenerTimeout: number<span class="tt">. The timeout in milliseconds to wait for abort listener's before stopping it forcefully, triggering cleanup. Default value is </span>1000<span class="tt">.</span></li>
<li><span class="tt"></span>forkArgs: String[]<span class="tt">. For </span>process<span class="tt"> worker type. An array passed as </span>args<span class="tt"> to [child_process.fork](<a href="https://nodejs.org/api/child_process.html">https://nodejs.org/api/child_process.html</a>#child_processforkmodulepath-args-options)</span></li>
<li><span class="tt"></span>forkOpts: Object<span class="tt">. For </span>process<span class="tt"> worker type. An object passed as </span>options<span class="tt"> to [child_process.fork](<a href="https://nodejs.org/api/child_process.html">https://nodejs.org/api/child_process.html</a>#child_processforkmodulepath-args-options). See nodejs documentation for available options.</span></li>
<li><span class="tt"></span>workerOpts: Object<span class="tt">. For </span>web<span class="tt"> worker type. An object passed to the [constructor of the web worker](<a href="https://html.spec.whatwg.org/multipage/workers.html">https://html.spec.whatwg.org/multipage/workers.html</a>#dom-worker). See [WorkerOptions specification](<a href="https://html.spec.whatwg.org/multipage/workers.html">https://html.spec.whatwg.org/multipage/workers.html</a>#workeroptions) for available options.</span></li>
<li><span class="tt"></span>workerThreadOpts: Object<span class="tt">. For </span>worker<span class="tt"> worker type. An object passed to [worker_threads.options](<a href="https://nodejs.org/api/worker_threads.html">https://nodejs.org/api/worker_threads.html</a>#new-workerfilename-options). See nodejs documentation for available options.</span></li>
<li><span class="tt"></span>onCreateWorker: Function<span class="tt">. A callback that is called whenever a worker is being created. It can be used to allocate resources for each worker for example. The callback is passed as argument an object with the following properties:<ul>
<li></li>
</ul>
</span>forkArgs: String[]<span class="tt">: the </span>forkArgs<span class="tt"> option of this pool<ul>
<li></li>
</ul>
</span>forkOpts: Object<span class="tt">: the </span>forkOpts<span class="tt"> option of this pool<ul>
<li></li>
</ul>
</span>workerOpts: Object<span class="tt">: the </span>workerOpts<span class="tt"> option of this pool<ul>
<li></li>
</ul>
</span>script: string<span class="tt">: the </span>script<span class="tt"> option of this pool
    Optionally, this callback can return an object containing one or more of the above properties. The provided properties will be used to override the Pool properties for the worker being created.</span></li>
<li><span class="tt"></span>onTerminateWorker: Function<span class="tt">. A callback that is called whenever a worker is being terminated. It can be used to release resources that might have been allocated for this specific worker. The callback is passed as argument an object as described for </span>onCreateWorker<span class="tt">, with each property sets with the value for the worker being terminated.</span></li>
<li><span class="tt"></span>emitStdStreams: boolean<span class="tt">. For </span>process<span class="tt"> or </span>thread<span class="tt"> worker type. If </span>true<span class="tt">, the worker will emit </span>stdout<span class="tt"> and </span>stderr<span class="tt"> events instead of passing it through to the parent streams. Default value is </span>false`.</li>
</ul>
<blockquote class="doxtable">
<p>Important note on &lsquo;'workerType&rsquo;<span class="tt">: when sending and receiving primitive data types (plain JSON) from and to a worker, the different worker types (</span>'web'<span class="tt">, </span>'process'<span class="tt">, </span>'thread'<span class="tt">) can be used interchangeably. However, when using more advanced data types like buffers, the API and returned results can vary. In these cases, it is best not to use the </span>'auto'<span class="tt"> setting but have a fixed </span>'workerType'` and good unit testing in place. </p>
</blockquote>
<p>A worker pool contains the following functions:</p>
<ul>
<li><span class="tt">Pool.exec(method: Function | string, params: Array | null [, options: Object]) : Promise&lt;any, Error&gt;</span><br  />
 Execute a function on a worker with given arguments.<ul>
<li>When <span class="tt">method</span> is a string, a method with this name must exist at the worker and must be registered to make it accessible via the pool. The function will be executed on the worker with given parameters.</li>
<li>When <span class="tt">method</span> is a function, the provided function <span class="tt">fn</span> will be stringified, send to the worker, and executed there with the provided parameters. The provided function must be static, it must not depend on variables in a surrounding scope.</li>
<li>The following options are available:<ul>
<li><span class="tt">on: (payload: any) =&gt; void</span>. An event listener, to handle events sent by the worker for this execution. See Events for more details.</li>
<li><span class="tt">transfer: Object[]</span>. A list of transferable objects to send to the worker. Not supported by <span class="tt">process</span> worker type. See <a href="./examples/transferableObjects.js">example</a> for usage.</li>
</ul>
</li>
</ul>
</li>
<li><span class="tt">Pool.proxy() : Promise&lt;Object, Error&gt;</span><br  />
 Create a proxy for the worker pool. The proxy contains a proxy for all methods available on the worker. All methods return promises resolving the methods result.</li>
<li><p class="startli"><span class="tt">Pool.stats() : Object</span><br  />
 Retrieve statistics on workers, and active and pending tasks.</p>
<p class="startli">Returns an object containing the following properties:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  totalWorkers: 0,</div>
<div class="line">  busyWorkers: 0,</div>
<div class="line">  idleWorkers: 0,</div>
<div class="line">  pendingTasks: 0,</div>
<div class="line">  activeTasks: 0</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li><p class="startli"><span class="tt">Pool.terminate([force: boolean [, timeout: number]]) : Promise&lt;void, Error&gt;</span></p>
<p class="startli">If parameter <span class="tt">force</span> is false (default), workers will finish the tasks they are working on before terminating themselves. Any pending tasks will be rejected with an error 'Pool terminated'. When <span class="tt">force</span> is true, all workers are terminated immediately without finishing running tasks. If <span class="tt">timeout</span> is provided, worker will be forced to terminate when the timeout expires and the worker has not finished.</p>
</li>
</ul>
<p>The function <span class="tt">Pool.exec</span> and the proxy functions all return a <span class="tt">Promise</span>. The promise has the following functions available:</p>
<ul>
<li><span class="tt">Promise.then(fn: Function&lt;result: any&gt;) : Promise&lt;any, Error&gt;</span><br  />
 Get the result of the promise once resolve.</li>
<li><span class="tt">Promise.catch(fn: Function&lt;error: Error&gt;) : Promise&lt;any, Error&gt;</span><br  />
 Get the error of the promise when rejected.</li>
<li><span class="tt">Promise.finally(fn: Function&lt;void&gt;)</span><br  />
 Logic to run when the Promise either <span class="tt">resolves</span> or <span class="tt">rejects</span></li>
<li><span class="tt">Promise.cancel() : Promise&lt;any, Error&gt;</span><br  />
 A running task can be cancelled. The worker executing the task is enforced to terminate immediately. The promise will be rejected with a <span class="tt">Promise.CancellationError</span>.</li>
<li><span class="tt">Promise.timeout(delay: number) : Promise&lt;any, Error&gt;</span><br  />
 Cancel a running task when it is not resolved or rejected within given delay in milliseconds. The timer will start when the task is actually started, not when the task is created and queued. The worker executing the task is enforced to terminate immediately. The promise will be rejected with a <span class="tt">Promise.TimeoutError</span>.</li>
</ul>
<p>Example usage:</p>
<div class="fragment"><div class="line">const workerpool = require(&#39;workerpool&#39;);</div>
<div class="line"> </div>
<div class="line">function add(a, b) {</div>
<div class="line">  return a + b;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">const pool1 = workerpool.pool();</div>
<div class="line"> </div>
<div class="line">// offload a function to a worker</div>
<div class="line">pool1</div>
<div class="line">  .exec(add, [2, 4])</div>
<div class="line">  .then(function (result) {</div>
<div class="line">    console.log(result); // will output 6</div>
<div class="line">  })</div>
<div class="line">  .catch(function (err) {</div>
<div class="line">    console.error(err);</div>
<div class="line">  });</div>
<div class="line"> </div>
<div class="line">// create a dedicated worker</div>
<div class="line">const pool2 = workerpool.pool(__dirname + &#39;/myWorker.js&#39;);</div>
<div class="line"> </div>
<div class="line">// supposed myWorker.js contains a function &#39;fibonacci&#39;</div>
<div class="line">pool2</div>
<div class="line">  .exec(&#39;fibonacci&#39;, [10])</div>
<div class="line">  .then(function (result) {</div>
<div class="line">    console.log(result); // will output 55</div>
<div class="line">  })</div>
<div class="line">  .catch(function (err) {</div>
<div class="line">    console.error(err);</div>
<div class="line">  });</div>
<div class="line"> </div>
<div class="line">// send a transferable object to the worker</div>
<div class="line">// supposed myWorker.js contains a function &#39;sum&#39;</div>
<div class="line">const toTransfer = new Uint8Array(2).map((_v, i) =&gt; i)</div>
<div class="line">pool2</div>
<div class="line">  .exec(&#39;sum&#39;, [toTransfer], { transfer: [toTransfer.buffer] })</div>
<div class="line">  .then(function (result) {</div>
<div class="line">    console.log(result); // will output 3</div>
<div class="line">  })</div>
<div class="line">  .catch(function (err) {</div>
<div class="line">    console.error(err);</div>
<div class="line">  });</div>
<div class="line"> </div>
<div class="line">// create a proxy to myWorker.js</div>
<div class="line">pool2</div>
<div class="line">  .proxy()</div>
<div class="line">  .then(function (myWorker) {</div>
<div class="line">    return myWorker.fibonacci(10);</div>
<div class="line">  })</div>
<div class="line">  .then(function (result) {</div>
<div class="line">    console.log(result); // will output 55</div>
<div class="line">  })</div>
<div class="line">  .catch(function (err) {</div>
<div class="line">    console.error(err);</div>
<div class="line">  });</div>
<div class="line"> </div>
<div class="line">// create a pool with a specified maximum number of workers</div>
<div class="line">const pool3 = workerpool.pool({ maxWorkers: 7 });</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md15524"></a>
worker</h2>
<p>A worker is constructed as:</p>
<p><span class="tt">workerpool.worker([methods: Object&lt;String, Function&gt;] [, options: Object]) : void</span></p>
<p>Argument <span class="tt">methods</span> is optional and can be an object with functions available in the worker. Registered functions will be available via the worker pool.</p>
<p>The following options are available:</p>
<ul>
<li><span class="tt">onTerminate: ([code: number]) =&gt; Promise&lt;void&gt; | void</span>. A callback that is called whenever a worker is being terminated. It can be used to release resources that might have been allocated for this specific worker. The difference with pool's <span class="tt">onTerminateWorker</span> is that this callback runs in the worker context, while <span class="tt">onTerminateWorker</span> is executed on the main thread.</li>
</ul>
<p>Example usage:</p>
<div class="fragment"><div class="line">// file myWorker.js</div>
<div class="line">const workerpool = require(&#39;workerpool&#39;);</div>
<div class="line"> </div>
<div class="line">function add(a, b) {</div>
<div class="line">  return a + b;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">function multiply(a, b) {</div>
<div class="line">  return a * b;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// create a worker and register functions</div>
<div class="line">workerpool.worker({</div>
<div class="line">  add: add,</div>
<div class="line">  multiply: multiply,</div>
<div class="line">});</div>
</div><!-- fragment --><p>Asynchronous results can be handled by returning a Promise from a function in the worker:</p>
<div class="fragment"><div class="line">// file myWorker.js</div>
<div class="line">const workerpool = require(&#39;workerpool&#39;);</div>
<div class="line"> </div>
<div class="line">function timeout(delay) {</div>
<div class="line">  return new Promise(function (resolve, reject) {</div>
<div class="line">    setTimeout(resolve, delay);</div>
<div class="line">  });</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// create a worker and register functions</div>
<div class="line">workerpool.worker({</div>
<div class="line">  timeout: timeout,</div>
<div class="line">});</div>
</div><!-- fragment --><p>Transferable objects can be sent back to the pool using <span class="tt">Transfer</span> helper class:</p>
<div class="fragment"><div class="line">// file myWorker.js</div>
<div class="line">const workerpool = require(&#39;workerpool&#39;);</div>
<div class="line"> </div>
<div class="line">function array(size) {</div>
<div class="line">  var array = new Uint8Array(size).map((_v, i) =&gt; i);</div>
<div class="line">  return new workerpool.Transfer(array, [array.buffer]);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// create a worker and register functions</div>
<div class="line">workerpool.worker({</div>
<div class="line">  array: array,</div>
<div class="line">});</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md15525"></a>
Events</h2>
<p>You can send data back from workers to the pool while the task is being executed using the <span class="tt">workerEmit</span> function:</p>
<p><span class="tt">workerEmit(payload: any) : unknown</span></p>
<p>This function only works inside a worker <b>and</b> during a task.</p>
<p>Example:</p>
<div class="fragment"><div class="line">// file myWorker.js</div>
<div class="line">const workerpool = require(&#39;workerpool&#39;);</div>
<div class="line"> </div>
<div class="line">function eventExample(delay) {</div>
<div class="line">  workerpool.workerEmit({</div>
<div class="line">    status: &#39;in_progress&#39;,</div>
<div class="line">  });</div>
<div class="line"> </div>
<div class="line">  workerpool.workerEmit({</div>
<div class="line">    status: &#39;complete&#39;,</div>
<div class="line">  });</div>
<div class="line"> </div>
<div class="line">  return true;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// create a worker and register functions</div>
<div class="line">workerpool.worker({</div>
<div class="line">  eventExample: eventExample,</div>
<div class="line">});</div>
</div><!-- fragment --><p>To receive those events, you can use the <span class="tt">on</span> option of the pool <span class="tt">exec</span> method:</p>
<div class="fragment"><div class="line">pool.exec(&#39;eventExample&#39;, [], {</div>
<div class="line">  on: function (payload) {</div>
<div class="line">    if (payload.status === &#39;in_progress&#39;) {</div>
<div class="line">      console.log(&#39;In progress...&#39;);</div>
<div class="line">    } else if (payload.status === &#39;complete&#39;) {</div>
<div class="line">      console.log(&#39;Done!&#39;);</div>
<div class="line">    }</div>
<div class="line">  },</div>
<div class="line">});</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md15526"></a>
Worker API</h2>
<p>Workers have access to a <span class="tt">worker</span> api which contains the following methods</p>
<ul>
<li><span class="tt">emit: (payload: unknown | Transfer): void</span></li>
<li><span class="tt">addAbortListener: (listener: () =&gt; Promise&lt;void&gt;): void</span></li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md15527"></a>
addAbortListener</h3>
<p>Worker termination may be recoverable through <span class="tt">abort listeners</span> which are registered through <span class="tt">worker.addAbortListener</span>. If all registered listeners resolve then the worker will not be terminated, allowing for worker reuse in some cases.</p>
<p>NOTE: For operations to successfully clean up, a worker implementation should be <em>async</em>. If the worker thread is blocked, then the worker will be killed.</p>
<div class="fragment"><div class="line">function asyncTimeout() {</div>
<div class="line">  var me = this;</div>
<div class="line">  return new Promise(function (resolve) {</div>
<div class="line">    let timeout = setTimeout(() =&gt; {</div>
<div class="line">        resolve();</div>
<div class="line">    }, 5000);</div>
<div class="line"> </div>
<div class="line">    // Register a listener which will resolve before the time out</div>
<div class="line">    // above triggers.</div>
<div class="line">    me.worker.addAbortListener(async function () {</div>
<div class="line">        clearTimeout(timeout);</div>
<div class="line">        resolve();</div>
<div class="line">    });</div>
<div class="line">  });</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// create a worker and register public functions</div>
<div class="line">workerpool.worker(</div>
<div class="line">  {</div>
<div class="line">    asyncTimeout: asyncTimeout,</div>
<div class="line">  },</div>
<div class="line">  {</div>
<div class="line">    abortListenerTimeout: 1000</div>
<div class="line">  }</div>
<div class="line">);</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="autotoc_md15528"></a>
emit</h3>
<p>Events may also be emitted from the <span class="tt">worker</span> api through <span class="tt">worker.emit</span></p>
<div class="fragment"><div class="line">// file myWorker.js</div>
<div class="line">const workerpool = require(&#39;workerpool&#39;);</div>
<div class="line"> </div>
<div class="line">function eventExample(delay) {</div>
<div class="line">  this.worker.emit({</div>
<div class="line">    status: &quot;in_progress&quot;,</div>
<div class="line">  });</div>
<div class="line">  workerpool.workerEmit({</div>
<div class="line">    status: &#39;complete&#39;,</div>
<div class="line">  });</div>
<div class="line"> </div>
<div class="line">  return true;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// create a worker and register functions</div>
<div class="line">workerpool.worker({</div>
<div class="line">  eventExample: eventExample,</div>
<div class="line">});</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md15529"></a>
Utilities</h2>
<p>Following properties are available for convenience:</p>
<ul>
<li><b>platform</b>: The Javascript platform. Either <em>node</em> or <em>browser</em></li>
<li><b>isMainThread</b>: Whether the code is running in main thread or not (Workers)</li>
<li><b>cpus</b>: The number of CPUs/cores available</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md15530"></a>
Roadmap</h1>
<ul>
<li>Implement functions for parallel processing: <span class="tt">map</span>, <span class="tt">reduce</span>, <span class="tt">forEach</span>, <span class="tt">filter</span>, <span class="tt">some</span>, <span class="tt">every</span>, ...</li>
<li>Implement graceful degradation on old browsers not supporting webworkers: fallback to processing tasks in the main application.</li>
<li>Implement session support: be able to handle a series of related tasks by a single worker, which can keep a state for the session.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md15531"></a>
Related libraries</h1>
<ul>
<li><a href="https://github.com/andywer/threads.js">https://github.com/andywer/threads.js</a></li>
<li><a href="https://github.com/piscinajs/piscina">https://github.com/piscinajs/piscina</a></li>
<li><a href="https://github.com/learnboost/cluster">https://github.com/learnboost/cluster</a></li>
<li><a href="https://github.com/adambom/parallel.js">https://github.com/adambom/parallel.js</a></li>
<li><a href="https://github.com/padolsey/operative">https://github.com/padolsey/operative</a></li>
<li><a href="https://github.com/calvinmetcalf/catiline">https://github.com/calvinmetcalf/catiline</a></li>
<li><a href="https://github.com/Unitech/pm2">https://github.com/Unitech/pm2</a></li>
<li><a href="https://github.com/godaddy/node-cluster-service">https://github.com/godaddy/node-cluster-service</a></li>
<li><a href="https://github.com/ramesaliyev/EasyWebWorker">https://github.com/ramesaliyev/EasyWebWorker</a></li>
<li><a href="https://github.com/rvagg/node-worker-farm">https://github.com/rvagg/node-worker-farm</a></li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md15532"></a>
Build</h1>
<p>First clone the project from github: </p><pre class="fragment">git clone git://github.com/josdejong/workerpool.git
cd workerpool
</pre><p>Install the project dependencies: </p><pre class="fragment">npm install
</pre><p>Then, the project can be build by executing the build script via npm: </p><pre class="fragment">npm run build
</pre><p>This will build the library workerpool.js and workerpool.min.js from the source files and put them in the folder dist.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md15533"></a>
Test</h1>
<p>To execute tests for the library, install the project dependencies once: </p><pre class="fragment">npm install
</pre><p>Then, the tests can be executed: </p><pre class="fragment">npm test
</pre><p>To test code coverage of the tests: </p><pre class="fragment">npm run coverage
</pre><p>To see the coverage results, open the generated report in your browser: </p><pre class="fragment">./coverage/index.html
</pre><h1 class="doxsection"><a class="anchor" id="autotoc_md15534"></a>
Publish</h1>
<ul>
<li>Describe changes in HISTORY.md.</li>
<li>Update version in package.json, run <span class="tt">npm install</span> to update it in <span class="tt">package-lock.json</span> too.</li>
<li>Push to GitHub.</li>
<li>Deploy to npm via <span class="tt">npm publish</span>.</li>
<li>Add a git tag with the version number like: <div class="fragment"><div class="line">git tag v1.2.3</div>
<div class="line">git push --tags</div>
</div><!-- fragment --></li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md15535"></a>
License</h1>
<p>Copyright (C) 2014-2025 Jos de Jong <a href="#" onclick="location.href='mai'+'lto:'+'wjo'+'sd'+'ejo'+'ng'+'@gm'+'ai'+'l.c'+'om'; return false;">wjosd<span class="obfuscator">.nosp@m.</span>ejon<span class="obfuscator">.nosp@m.</span>g@gma<span class="obfuscator">.nosp@m.</span>il.c<span class="obfuscator">.nosp@m.</span>om</a></p>
<p>Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at</p>
<p><a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></p>
<p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License. </p>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="dir_8983b1862dce8a71846356b6209105f4.html">EcoEats-Project</a></li><li class="navelem"><a href="dir_5091f2b68170d33f954320199e2fed0a.html">node_modules</a></li><li class="navelem"><a href="dir_a261e13de7057cfdb8752ad823916978.html">workerpool</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
